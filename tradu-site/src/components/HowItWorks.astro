---
interface Step {
  title: string;
  description: string;
}

interface HowItWorksCopy {
  title: string;
  subtitle?: string;
  steps: Step[];
}

interface Props {
  copy: HowItWorksCopy;
}

const { copy } = Astro.props;
const steps = copy.steps as Step[];
---

<style is:global>
  .fade-up {
    opacity: 0;
    transform: translateY(18px);
    transition: opacity 700ms ease, transform 700ms ease;
    will-change: opacity, transform;
  }

  .fade-up.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<section
  id="como-funciona"
  class="relative py-20 px-4 bg-[var(--background-color)] overflow-hidden"
>
  <!-- Fondo de puntos -->
  <div
    class="absolute inset-0 z-0 opacity-[0.25]
           [background-size:18px_18px]
           [background-image:radial-gradient(#d8d8d8_1px,transparent_1px)]"
  ></div>

  <div class="relative z-10 max-w-6xl mx-auto">
    <!-- TÍTULO -->
    <div class="text-center mb-12 fade-up">
      <h2 class="text-3xl md:text-4xl font-bold text-[var(--brand-black)]">
        {copy.title}
      </h2>

      {copy.subtitle && (
        <p
          class="mt-3 text-sm md:text-base text-slate-600
                 max-w-2xl mx-auto leading-relaxed"
        >
          {copy.subtitle}
        </p>
      )}
    </div>

    <!-- GRID STEPS -->
    <div class="grid gap-5 md:grid-cols-3 lg:grid-cols-4">
      {steps.map((step, index) => (
        <article
          class="fade-up bg-white/75 backdrop-blur rounded-3xl
                 border border-slate-200 shadow-sm
                 px-6 py-7 flex flex-col gap-3 text-left
                 transition-all duration-300
                 hover:-translate-y-1 hover:shadow-lg hover:border-slate-300"
        >
          <!-- Número (misma forma que Benefits, color rojo) -->
          <div
            class="h-10 w-10 rounded-xl flex items-center justify-center
                   text-white text-sm font-bold
                   bg-[var(--brand-primary)]"
            aria-hidden="true"
          >
            {index + 1}
          </div>

          <!-- Título paso -->
          <h3 class="text-base md:text-lg font-semibold text-[var(--brand-black)]">
            {step.title}
          </h3>

          <!-- Descripción -->
          <p class="text-sm text-slate-600 leading-relaxed">
            {step.description}
          </p>
        </article>
      ))}
    </div>
  </div>
</section>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    if (!("IntersectionObserver" in window)) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          entry.target.classList.toggle("is-visible", entry.isIntersecting);
        });
      },
      { threshold: 0.18 }
    );

    document.querySelectorAll(".fade-up").forEach((el) => observer.observe(el));
  });
</script>
