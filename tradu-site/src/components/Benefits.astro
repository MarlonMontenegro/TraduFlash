---
import { Image } from "astro:assets";

interface BenefitItem {
  title: string;
  description: string;
}

type BenefitImage = string | ImageMetadata;

interface Props {
  title: string;
  items: BenefitItem[];
  imageSrc?: BenefitImage;
  imageAlt?: string;
  eyebrow?: string;
}

const {
  title,
  items,
  imageSrc = "/beneficios-web.svg",
  imageAlt = "Beneficios del servicio",
  eyebrow = "BENEFICIOS",
} = Astro.props;

const isMeta = typeof imageSrc !== "string";
---

<style is:global>
  :root {
    --brand-blue: #014f86;
  }

  .benefits-dots {
    position: absolute;
    inset: 0;
    opacity: 0.55;
    background-size: 20px 20px;
    background-image: radial-gradient(#d4d4d4 1px, transparent 1px);
    z-index: 0;
  }

  .benefits-mask {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    background: var(--background-color);
    -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
    mask-image: radial-gradient(ellipse at center, transparent 20%, black);
  }

  .io-fade {
    opacity: 0;
    transform: translateY(18px);
    transition: opacity 700ms ease, transform 700ms ease;
    will-change: opacity, transform;
  }

  .io-fade.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .benefit-number {
    background: var(--brand-blue);
  }
</style>

<section class="relative py-20 px-4 overflow-hidden bg-[var(--background-color)]">
  <!-- Dot background -->
  <div class="benefits-dots" aria-hidden="true"></div>
  <!-- Radial mask -->
  <div class="benefits-mask" aria-hidden="true"></div>

  <div class="relative z-10 max-w-6xl mx-auto">
    <!-- Header -->
    <div class="io-fade text-center max-w-3xl mx-auto">
      <p class="text-xs md:text-sm tracking-[0.3em] uppercase text-[var(--brand-blue)]">
        {eyebrow}
      </p>
      <h2 class="mt-3 text-3xl md:text-4xl font-extrabold text-[var(--brand-black)]">
        {title}
      </h2>
    </div>

    <!-- Grid -->
    <div class="mt-12 grid lg:grid-cols-2 gap-10 items-center">
      <!-- Cards -->
      <div class="grid gap-4">
        {items.map((b, idx) => (
          <article
            class="io-fade rounded-2xl border border-slate-200 bg-white/75 backdrop-blur
                   p-5 md:p-6 shadow-sm transition-all duration-300
                   hover:-translate-y-1 hover:shadow-lg hover:border-slate-300"
          >
            <div class="flex items-start gap-4">
              <!-- NÃºmero -->
              <div
                class="shrink-0 h-12 w-12 rounded-2xl border border-slate-200 bg-white
                       flex items-center justify-center"
                aria-hidden="true"
              >
                <div
                  class="benefit-number h-9 w-9 rounded-xl flex items-center justify-center
                         text-white text-sm font-bold"
                >
                  {idx + 1}
                </div>
              </div>

              <div class="min-w-0">
                <h3 class="text-lg md:text-xl font-bold text-[var(--brand-black)]">
                  {b.title}
                </h3>
                <p class="mt-1 text-sm md:text-[0.98rem] text-slate-600 leading-relaxed">
                  {b.description}
                </p>
              </div>
            </div>
          </article>
        ))}
      </div>

      <!-- Imagen centrada + radius tipo hero -->
      <div class="io-fade flex justify-center items-center">
        {isMeta ? (
          <Image
            src={imageSrc}
            alt={imageAlt}
            class="w-full max-w-xl h-auto object-cover rounded-3xl md:rounded-[2.5rem] shadow-sm"
            widths={[640, 960, 1280]}
            sizes="(max-width: 1024px) 100vw, 50vw"
            format="webp"
            loading="lazy"
          />
        ) : (
          <img
            src={imageSrc}
            alt={imageAlt}
            class="w-full max-w-xl h-auto object-cover rounded-3xl md:rounded-[2.5rem] shadow-sm"
            loading="lazy"
            decoding="async"
          />
        )}
      </div>
    </div>
  </div>

  <script is:inline>
    document.addEventListener("DOMContentLoaded", () => {
      if (!("IntersectionObserver" in window)) return;

      const els = document.querySelectorAll(".io-fade");

      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            entry.target.classList.toggle("is-visible", entry.isIntersecting);
          });
        },
        { threshold: 0.18 }
      );

      els.forEach((el) => io.observe(el));
    });
  </script>
</section>
