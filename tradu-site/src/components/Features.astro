---
interface Props {
  lang: "en" | "es";
  t: any;
}

const { t } = Astro.props;

// Convertimos los items del JSON a un array dinámico:
const featureItems = [
  t.features.item1,
  t.features.item2,
  t.features.item3,
  t.features.item4,
  t.features.item5,
  t.features.item6,
];

// Íconos (uno por card)
const icons = [
  "user",       // item1
  "shield",     // item2
  "clock",      // item3
  "badge",      // item4
  "stamp",      // item5
  "lock",       // item6
];

function renderIcon(name: string) {
  switch (name) {
    case "user":
      return `<path d='M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4z'/><path d='M4 20a8 8 0 0 1 16 0'/>`;
    case "shield":
      return `<path d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'/>`;
    case "clock":
      return `<circle cx='12' cy='12' r='9'/><path d='M12 7v5l3 2'/>`;
    case "badge":
      return `<path d='M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 22 12 18.56 5.82 22 7 14.14l-5-4.87 6.91-1.01z'/>`;
    case "stamp":
      return `<circle cx='12' cy='12' r='3'/><path d='M5 20h14v2H5z'/>`;
    case "lock":
      return `<rect x='6' y='10' width='12' height='10' rx='2'/><path d='M12 6a4 4 0 0 0-4 4v2h8v-2a4 4 0 0 0-4-4z'/>`;
  }
}
---

<style is:global>
  /* Base para elementos que se animan con scroll */
  .fade-on-scroll {
    opacity: 0;
    transform: translateY(16px);
  }

  .fade-on-scroll.is-visible {
    animation: featureFadeUp 0.6s ease-out forwards;
  }

  /* Stagger solo para las cards (orden dentro del grid) */
  .fade-on-scroll.is-visible.feature-card:nth-child(1) { animation-delay: 0.05s; }
  .fade-on-scroll.is-visible.feature-card:nth-child(2) { animation-delay: 0.12s; }
  .fade-on-scroll.is-visible.feature-card:nth-child(3) { animation-delay: 0.19s; }
  .fade-on-scroll.is-visible.feature-card:nth-child(4) { animation-delay: 0.26s; }
  .fade-on-scroll.is-visible.feature-card:nth-child(5) { animation-delay: 0.33s; }
  .fade-on-scroll.is-visible.feature-card:nth-child(6) { animation-delay: 0.40s; }

  @keyframes featureFadeUp {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<section class="relative bg-white py-24 px-6">
  <!-- Dots background -->
  <div
    class="absolute inset-0 z-0 opacity-40
           [background-size:20px_20px]
           [background-image:radial-gradient(#d4d4d4_1px,transparent_1px)]"
  ></div>

  <!-- Fade mask -->
  <div
    class="pointer-events-none absolute inset-0 bg-white
           [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)]"
  ></div>

  <div class="relative z-10 max-w-7xl mx-auto">
    <!-- TITLE con animación en scroll -->
    <h2
      class="fade-on-scroll features-title
             text-center text-3xl md:text-6xl font-bold
             text-[var(--brand-black)]
             mb-12 leading-[1.15] max-w-4xl mx-auto"
    >
      {t.features.title}
    </h2>

    <!-- GRID -->
    <div class="grid gap-6 md:grid-cols-3">
      {featureItems.map((item, i) => (
        <article
          class="fade-on-scroll feature-card
                 bg-white rounded-2xl border border-slate-200
                 shadow-sm p-6 flex flex-col gap-4
                 transition-transform duration-200 hover:-translate-y-1 hover:shadow-lg"
        >
          <div class="flex items-center gap-3">
            <div
              class="h-12 w-12 flex items-center justify-center rounded-xl
                     bg-[var(--brand-primary)]/10 text-[var(--brand-primary)]"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                class="w-6 h-6 stroke-[2]"
                set:html={renderIcon(icons[i])}
              ></svg>
            </div>

            <h3 class="text-lg md:text-xl font-semibold text-[var(--brand-black)]">
              {item.title}
            </h3>
          </div>

          <p class="text-sm md:text-base text-slate-600 leading-relaxed">
            {item.desc}
          </p>
        </article>
      ))}
    </div>
  </div>

  <script>
    // Animación en scroll con IntersectionObserver
    if (typeof window !== "undefined" && "IntersectionObserver" in window) {
      const elements = document.querySelectorAll(".fade-on-scroll");

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
            } else {
              // Para que vuelva a animar si subís/bajás
              entry.target.classList.remove("is-visible");
            }
          });
        },
        { threshold: 0.2 }
      );

      elements.forEach((el) => observer.observe(el));
    }
  </script>
</section>
