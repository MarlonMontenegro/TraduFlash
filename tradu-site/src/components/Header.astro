---
import logo from "../../public/logo.svg";

interface Props {
  lang: "en" | "es";
  t: any;
}

const { lang, t } = Astro.props;

// helper: siempre con trailing slash
const withSlash = (p: string) => (p.endsWith("/") ? p : `${p}/`);

const routes = {
  home: lang === "es" ? "/es/" : "/en/",
  live: lang === "es" ? "/es/traducciones-en-vivo/" : "/en/live-translation/",
  web: lang === "es" ? "/es/traduccion-paginas-web/" : "/en/website-translation/",
  about: lang === "es" ? "/es/sobre-nosotros/" : "/en/about-us/",
  quote: lang === "es" ? "/es/cotizacion/" : "/en/quote/",
  documents: lang === "es" ? "/es/traduccion-documentos/" : "/en/documents-translation/",
};

const path = withSlash(Astro.url.pathname);

const switchMap: Record<string, string> = {
  "/es/": "/en/",
  "/en/": "/es/",

  "/es/cotizacion/": "/en/quote/",
  "/en/quote/": "/es/cotizacion/",

  "/es/sobre-nosotros/": "/en/about-us/",
  "/en/about-us/": "/es/sobre-nosotros/",

  "/es/traducciones-en-vivo/": "/en/live-translation/",
  "/en/live-translation/": "/es/traducciones-en-vivo/",

  "/es/traduccion-paginas-web/": "/en/website-translation/",
  "/en/website-translation/": "/es/traduccion-paginas-web/",

  "/es/traduccion-documentos/": "/en/documents-translation/",
  "/en/documents-translation/": "/es/traduccion-documentos/",
};

const enHref = lang === "en" ? path : (switchMap[path] || "/en/");
const esHref = lang === "es" ? path : (switchMap[path] || "/es/");
---
<div
  x-data="{ open: false, servicesOpen: false }"
  x-effect="document.documentElement.style.overflow = open ? 'hidden' : ''"
  class="relative"
>
  <!-- NAVBAR -->
  <nav class="fixed inset-x-0 top-0 md:top-4 z-50">
    <div
      class="mx-auto max-w-6xl flex items-center justify-between
             bg-[var(--background-color)]
             px-4 py-3 md:px-8 md:py-4
             md:rounded-xl"
    >
      <!-- LOGO -->
      <a href={routes.home} class="flex items-center gap-3 hover:opacity-90 transition">
        <img src={logo.src} alt="TraduFlash Logo" class="h-11 w-auto object-contain" />
      </a>

      <!-- MENÚ DESKTOP -->
      <div class="hidden lg:flex flex-1 justify-center">
        <ul class="flex gap-12 text-lg font-medium text-[var(--brand-black)]">
          <li>
            <a href={routes.home} class="hover:text-[var(--brand-primary)] transition">
              {t.navbar.home}
            </a>
          </li>

          <li class="relative" @mouseenter="servicesOpen = true" @mouseleave="servicesOpen = false">
            <button
              type="button"
              class="inline-flex items-center gap-1 hover:text-[var(--brand-primary)] transition"
            >
              {t.navbar.services}
              <svg class="w-4 h-4 mt-[1px]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-width="2" d="M6 9l6 6 6-6" />
              </svg>
            </button>

            <div
              x-show="servicesOpen"
              x-transition.origin.top
              x-cloak
              class="absolute left-0 mt-2 w-56 rounded-xl bg-white shadow-lg border border-black/5 py-2"
            >
              <a href={routes.live} class="block px-4 py-2.5 text-sm text-[var(--brand-black)] hover:bg-black/5">
                {t.navbar.liveTranslations}
              </a>
              <a href={routes.web} class="block px-4 py-2.5 text-sm text-[var(--brand-black)] hover:bg-black/5">
                {t.navbar.websiteTranslations}
              </a>
              <a href={routes.documents} class="block px-4 py-2.5 text-sm text-[var(--brand-black)] hover:bg-black/5">
                {t.navbar.documents}
              </a>
            </div>
          </li>

          <li>
            <a href={routes.about} class="hover:text-[var(--brand-primary)] transition">
              {t.navbar.about}
            </a>
          </li>
        </ul>
      </div>

      <!-- CTA + LANG + BURGER -->
      <div class="flex items-center gap-4">
        <a
          href={routes.quote}
          class="hidden lg:inline-flex items-center justify-center px-7 py-3
                 rounded-full text-sm font-semibold btn-primary shadow-sm"
        >
          {t.navbar.button}
        </a>

        <!-- Selector idioma DESKTOP -->
        <div class="hidden md:flex items-center gap-1 text-sm font-medium">
          <a href={enHref} class={lang === "en" ? "text-[var(--brand-primary)]" : "text-slate-500"}>EN</a>
          <span class="text-slate-400">/</span>
          <a href={esHref} class={lang === "es" ? "text-[var(--brand-primary)]" : "text-slate-500"}>ES</a>
        </div>

        <!-- HAMBURGUESA -->
        <button
          @click="open = !open; servicesOpen = false"
          class="inline-flex items-center justify-center w-9 h-9 lg:hidden
                 rounded-full text-[var(--brand-black)] hover:bg-black/5 transition"
          aria-label="Open menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-width="2" d="M4 7h16M4 12h16M4 17h16" />
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- OVERLAY (FUERA del nav) -->
  <div
    x-show="open"
    x-transition.opacity
    x-cloak
    class="fixed inset-0 z-40 bg-black/40 lg:hidden"
    @click="open = false; servicesOpen = false"
  ></div>

  <!-- MENÚ MÓVIL -->
  <div
    x-show="open"
    x-transition.origin.top
    x-cloak
    class="lg:hidden fixed inset-x-0 top-[64px] z-50"
  >
    <div class="mx-auto max-w-6xl bg-white border-t border-black/10 px-4 py-4">
      <ul class="flex flex-col gap-3 text-lg font-medium text-[var(--brand-black)]">
        <li>
          <a href={routes.home} class="py-1" @click="open = false; servicesOpen = false">
            {t.navbar.about}
          </a>
        </li>

        <li class="pt-1">
          <button
            type="button"
            class="w-full flex items-center justify-between py-1 text-left"
            @click="servicesOpen = !servicesOpen"
          >
            <span>{t.navbar.services}</span>
            <svg
              class="w-4 h-4 transform transition"
              :class="servicesOpen ? 'rotate-180' : 'rotate-0'"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path stroke-linecap="round" stroke-width="2" d="M6 9l6 6 6-6" />
            </svg>
          </button>

          <ul x-show="servicesOpen" x-transition.origin.top x-cloak class="mt-2 ml-4 flex flex-col gap-1 text-base text-slate-700">
            <li>
              <a href={routes.live} class="py-1" @click="open = false; servicesOpen = false">
                {t.navbar.liveTranslations}
              </a>
            </li>
            <li>
              <a href={routes.web} class="py-1" @click="open = false; servicesOpen = false">
                {t.navbar.websiteTranslations}
              </a>
            </li>
          </ul>
        </li>

        <li>
          <a href={routes.about} class="py-1" @click="open = false; servicesOpen = false">
            {t.navbar.contact}
          </a>
        </li>

        <li>
          <a
            href={routes.quote}
            class="mt-2 inline-flex items-center justify-center px-6 py-2.5
                   rounded-full text-sm font-semibold btn-primary w-full"
            @click="open = false; servicesOpen = false"
          >
            {t.navbar.button}
          </a>
        </li>

        <!-- Selector idioma MÓVIL -->
        <li class="pt-3 mt-2 border-t border-black/10 flex gap-3 text-sm">
          <a href={enHref} class={lang === "en" ? "text-[var(--brand-primary)]" : "text-slate-500"}>EN</a>
          <span class="text-slate-400">/</span>
          <a href={esHref} class={lang === "es" ? "text-[var(--brand-primary)]" : "text-slate-500"}>ES</a>
        </li>
      </ul>
    </div>
  </div>
</div>
